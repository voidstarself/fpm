#+TITLE: Fabric Package Manager â€” MVP Specification

* Goal

Build a *minimal, correct Fabric mod package manager* implemented in *Rust* that installs Fabric-compatible mods using the *Modrinth API*.

The MVP focuses on:
- correctness
- reproducibility
- clear error reporting

This is a *CLI-only tool*. No GUI, no launcher integration, no modpacks.

* Non-Goals (Explicitly Out of Scope)

The MVP does *not* include:
- CurseForge support
- Modpack creation/import/export
- Launcher integration (Prism, MultiMC, etc.)
- Fabric Loader installation
- Quilt support
- Client/server profile separation
- Authentication
- GUI or TUI

* Target User

A technical Minecraft user who:
- runs Fabric
- understands CLI tools
- wants reproducible mod installs
- prefers automation over launchers

* Supported Platforms

- Linux
- macOS
- Windows

* Commands (Required)

** ~fabric init~

Creates a ~fabric.toml~ in the current directory.

Defaults:
- Minecraft version: required input
- Loader: ~fabric~

** ~fabric search <query>~

Searches Modrinth for projects compatible with:
- Fabric loader
- Minecraft version from ~fabric.toml~

Outputs:
- Project name
- Slug
- Short description

** ~fabric add <mod>[@version]~

Adds a mod to ~fabric.toml~ and installs it.

Behavior:
- If no version is specified, choose the latest compatible version
- Resolve required dependencies
- Download all resolved mods
- Write ~fabric.lock~
- Place JARs in ~mods/~

** ~fabric remove <mod>~

Removes a mod from ~fabric.toml~.

Behavior:
- Re-resolve dependency graph
- Remove unused dependencies
- Update ~fabric.lock~
- Delete unused JARs from ~mods/~

** ~fabric list~

Lists installed mods from ~fabric.lock~.

** ~fabric resolve~

Performs dependency resolution *without installing*.

Outputs:
- Selected versions
- Dependency tree
- Conflicts (if any)

* Configuration Files

** ~fabric.toml~ (User Intent)

#+begin_src toml
minecraft = "1.20.1"
loader = "fabric"

[mods]
sodium = "latest"
lithium = "^0.14"
#+end_src

** ~fabric.lock~ (Resolved State)

#+begin_src toml
minecraft = "1.20.1"
loader = "fabric"

[[mod]]
name = "sodium"
version = "0.5.8"
url = "https://cdn.modrinth.com/..."
sha512 = "abc123..."

[[mod]]
name = "lithium"
version = "0.14.2"
url = "https://cdn.modrinth.com/..."
sha512 = "def456..."
#+end_src

* Core Features

** Dependency Resolution
- Parse version constraints (~^~, ~~~, ~latest~, exact)
- Resolve transitive dependencies
- Detect conflicts
- Select compatible versions

** Download Management
- Fetch JARs from Modrinth CDN
- Verify file integrity (SHA-512 or SHA-1)
- Atomic writes to ~mods/~
- Progress indication

** Error Handling
- Missing ~fabric.toml~
- Invalid Minecraft version
- Incompatible mods
- Network failures
- Version conflicts
- File I/O errors

* Implementation Notes

** Language: Rust

Why Rust:
- Fast, safe, cross-platform
- Strong typing and error handling
- Excellent HTTP/async libraries
- Single binary distribution

** Dependencies
- ~clap~: CLI argument parsing
- ~serde~ + ~toml~: Config file handling
- ~reqwest~: HTTP client
- ~tokio~: Async runtime
- ~sha2~ or ~sha1~: Hash verification
- ~semver~: Version parsing

** API: Modrinth v2
- Search: ~/search~
- Project: ~/project/{id|slug}~
- Versions: ~/project/{id}/version~
- Download: Direct CDN links

* Out-of-Scope for MVP

The following are *explicitly deferred* to post-MVP:
- CurseForge API integration
- Modpack support (import/export)
- Launcher integration
- Fabric Loader installation
- Server-side mod profiles
- Authentication/API keys
- GUI/TUI
- Auto-updates
- Rollback functionality

* Success Criteria

The MVP is complete when:
1. All 6 commands work correctly
2. Dependencies resolve without conflicts
3. Downloads verify integrity
4. Error messages are clear
5. Works on Linux, macOS, Windows
6. Has basic test coverage
7. Documentation exists for all commands
